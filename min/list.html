<!DOCTYPE html><html><head><script src="https://www.parsecdn.com/js/parse-latest.js"></script><script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async></script><script src="../js/global.js"></script><script>initParse();var OneSignal=OneSignal||[];OneSignal.push(["init",{appId:"e1389734-7a53-42ac-9eed-42812382c796",subdomainName:"cse134virtuevice",safari_web_id:"web.onesignal.auto.34e4584e-b851-4129-9188-f0d7c790d3df",autoRegister:!1}]),document.addEventListener("DOMContentLoaded",function(){OneSignal.push(function(){if(OneSignal.isPushNotificationsSupported()){var e=document.getElementById("registerForPushLink");e.style.display="inline-block"}}),OneSignal.push(function(){function e(e){OneSignal.push(["registerForPushNotifications"],{modalPrompt:!0}),e.preventDefault()}document.getElementById("registerForPushLink").addEventListener("click",e,!1)})});</script><title>Virtue / Vice</title><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="stylesheet" type="text/css" href="../css/list.css"></head><body onload="checkCurrentUser()"><input id="advanceDayButton" class="standard-button" type="button" onclick="advanceDay()" value="Advance Day" title="Advance Day"><input id="logoutButton" class="standard-button" type="button" onclick="logOut()" value="Log Out" title="Log Out"><h3 id="usernameDisplay"></h3><input id="registerForPushLink" class="standard-button" type="button" style="display: none" value="Notifications" title="Subscribe To Notifications"><section><h1 id="header-text">Habit List</h1><ul id="active-list" class="habit-list"></ul></section><section><h1 id="inactive-title" style="visibility: hidden">Habits Inactive For Today</h1><ul id="inactive-list" class="habit-list"></ul></section><div id="addHabit-empty"><div id="addHabit-message"><p>You have no habits.<br>Click here to add one.</p></div><img id="addHabit-arrow" src="../img/downArrow.png" alt="Arrow"></div><div id="addHabit" onclick="location.href=&quot;add.html&quot;" title="Add Habit"><div style="position: relative; font-size: 2em; padding: 7px">+</div></div><script type="text/javascript">function formatTemplate(e){var t='\n             <ul class="habit-info">\n                 <li>\n                     <div class="habit-name">'+e.habit_id+'</div>\n                     <button id="options-button" type="button" class="op op-gear" onClick="toggleButton(this);" title="Habit Options">\n                         <img id="gear" class="gear-img" src="../img/gear.png" alt="Edit">\n                     </button>\n                     <div class="white-square"></div>\n                     <span id="options-slideout" class="options">\n                         <button type="button" class="op op-edit" onclick="editHabit(\''+e.habit_id+'\');" title="Edit Habit">\n                             <img class="small-buttons" src="../img/edit.svg" alt="Edit">\n                         </button>\n                         <button type="button" class="op op-del" onclick="deleteHabit(this, \''+e.habit_id+'\');" title="Delete Habit">\n                             <img class="small-buttons" src="../img/delete.svg" alt="Del">\n                         </button>\n                     </span>\n                 </li>\n                 <li>\n                     <img class="habit-icon" src="'+e.icon.icon_src+'" alt="habit icon"><br>\n                     <div class="week-container">\n                         <div class="week-bubble week-day-off">\n                             <div class="inner-week">S<small>u</small></div>\n                         </div>\n                         <div class="week-bubble week-day-off">\n                             <div class="inner-week">M</div>\n                         </div>\n                         <div class="week-bubble week-day-off">\n                             <div class="inner-week">T<small>u</small></div>\n                         </div>\n                         <div class="week-bubble week-day-off">\n                             <div class="inner-week">W</div>\n                         </div>\n                         <br><span style="margin-left: 14px;"></span>\n                         <div class="week-bubble week-day-off">\n                             <div class="inner-week">T<small>h</small></div>\n                         </div>\n                         <div class="week-bubble week-day-off">\n                             <div class="inner-week">F</div>\n                         </div>\n                         <div class="week-bubble week-day-off">\n                             <div class="inner-week">S<small>a</small></div>\n                         </div>\n                     </div>\n                 </li>\n             </ul>\n             <div class="message">\n                 <div class="message-total">\n                     <div class="graph-message">\n                     </div>\n                     <svg class="habit-graph" height="25" width="200">\n                         <line x1="20" y1="7" x2="160" y2="7" stroke="#F66659" stroke-width="11" stroke-linecap="round" />\n                         <line class="blue-line" x1="20" y1="7" x2="10" y2="7" stroke="#33C087" stroke-width="11" stroke-linecap="round" />\n                     </svg>\n                     <div class="complete-message">\n                         Completed <strong>0/1</strong> for today.\n                     </div>\n                 </div>\n             </div>\n             <div class="habit-op" id="button-container">\n                 <button type="button" class="op op-done" onclick="thumbsUp(\''+e.habit_id+'\');" title="Complete Habit">\n                     <img class="thumb-image" src="../img/thumbsUp.png" alt="Done">\n                 </button>\n                 <button type="button" class="op op-fail" onclick="thumbsDown(\''+e.habit_id+'\');" title="Fail Habit">\n                     <img class="thumb-image" src="../img/thumbsDown.png" alt="Done">\n                 </button>\n             </div> \n             <div class="notes-container">\n                 <div class="notes-button"> \n                     <input class="test-button" type="button" onclick="toggleNotes(this);" value="Notes"></input> \n                 </div> \n                 <div class="testy-2"> Notes: '+e.notes+" </div> \n             </div> \n             ";return t}function editHabit(e){var t=Parse.User.current(),a=Parse.Object.extend("List"),i=new Parse.Query(a);i.get(t.get("list"),{success:function(t){t.set("edit_id",e),t.save().then(function(){window.location="add.html"})},error:function(e,t){alert("Error: "+t.code+" "+t.message)}})}function deleteHabit(e,t){if(confirm("Are you sure you want to delete this habit?")){var a=Parse.User.current(),i=Parse.Object.extend("List"),n=new Parse.Query(i);n.get(a.get("list"),{success:function(i){var n,s=i.get("habits");for(n in s)if(s[n].habit_id==t){s.splice(n,1);break}i.set("habits",s),habitCRUDAnalytics("Delete",a.get("username"),t,""),i.save().then(function(){var t=getHabitRoot(e),a=t.parentNode;a.removeChild(t),checkForHabits()})},error:function(e,i){habitCRUDAnalytics("Delete",a.get("username"),t,JSON.stringify(i.code)),alert("Error: "+i.code+" "+i.message)}})}}function populateList(){var e=document.getElementById("active-list"),t=document.getElementById("inactive-list"),a=document.getElementById("usernameDisplay"),i=Parse.User.current();window.innerWidth<499?a.innerHTML=i.get("username"):a.innerHTML="Hello, "+i.get("username");var n=Parse.Object.extend("List"),s=new Parse.Query(n);s.get(i.get("list"),{success:function(a){var n,s,r=a.get("habits");for(s in r){n=r[s];var o=document.createElement("li"),l="habitItem_"+n.habit_id;o.setAttribute("id",l),o.innerHTML=formatTemplate(n);var d=currentDate.getDay();n.weekly_freq[d]?(e.appendChild(o),refreshHabit(n)):(t.appendChild(o),refreshHabit(n),disableHabit(n.habit_id));var c,u=document.getElementById(l),b=u.getElementsByClassName("week-container")[0],m=b.getElementsByClassName("week-bubble"),g=m.length;for(c=0;g>c;c++)n.weekly_freq[c]&&(m[c].className="week-bubble week-day")}window.getComputedStyle(e).opacity,e.style.opacity=1,window.getComputedStyle(t).opacity,t.style.opacity=1,a.set("edit_id",""),a.save(),habitCRUDAnalytics("Read",i.get("username"),"",""),checkForHabits()},error:function(e,t){habitCRUDAnalytics("Read",i.get("username"),"",JSON.stringify(t.code)),alert("Error: "+t.code+" "+t.message)}})}function checkForHabits(){var e=document.getElementById("active-list"),t=document.getElementById("inactive-list"),a=document.getElementById("inactive-title"),i=document.getElementById("addHabit-empty");e.childNodes.length<=0&&t.childNodes.length<=0?i.style.visibility="visible":i.style.visibility="hidden",t.childNodes.length<=0?a.style.visibility="hidden":a.style.visibility="visible"}function thumbsUp(e){var t=Parse.User.current(),a=Parse.Object.extend("List"),i=new Parse.Query(a),n=document.getElementById("habitItem_"+e),s=n.getElementsByClassName("habit-op")[0],r=s.children[0],o=s.children[1];r.disabled=!0,o.disabled=!0,i.get(t.get("list"),{success:function(a){var i,n=a.get("habits");for(i in n)if(n[i].habit_id==e){curHabit=n[i];break}curHabit.completed_today+=1,curHabit.completed_today>=curHabit.daily_freq&&(curHabit.completed_days+=1,curHabit.current_streak+=1,curHabit.current_streak>curHabit.longest_streak&&(curHabit.longest_streak=curHabit.current_streak)),habitInteractionAnalytics("ThumbsUp",t.get("username"),e,""),a.set("habits",n),a.save().then(function(){refreshHabit(curHabit)})},error:function(a,i){habitInteractionAnalytics("ThumbsUp",t.get("username"),e,JSON.stringify(i.code)),alert("Error: "+i.code+" "+i.message)}})}function thumbsDown(e){var t=Parse.User.current(),a=Parse.Object.extend("List"),i=new Parse.Query(a),n=document.getElementById("habitItem_"+e),s=n.getElementsByClassName("habit-op")[0],r=s.children[0],o=s.children[1];r.disabled=!0,o.disabled=!0,i.get(t.get("list"),{success:function(a){var i,n=a.get("habits");for(i in n)if(n[i].habit_id==e){curHabit=n[i];break}curHabit.completed_today=-1,curHabit.current_streak=0,habitInteractionAnalytics("ThumbsDown",t.get("username"),e,""),a.set("habits",n),a.save().then(function(){refreshHabit(curHabit)})},error:function(a,i){habitInteractionAnalytics("ThumbsDown",t.get("username"),e,JSON.stringify(i.code)),alert("Error: "+i.code+" "+i.message)}})}function disableHabit(e){var t,a=document.getElementById("habitItem_"+e),i=a.getElementsByClassName("habit-op")[0],n=i.children[0],s=i.children[1],r=a.getElementsByClassName("thumb-image"),o=r.length;for(t=0;o>t;t++)r[t].style.opacity="0.4";n.disabled=!0,s.disabled=!0,n.className="op button-disabled",s.className="op button-disabled"}function enableHabit(e){var t,a=document.getElementById("habitItem_"+e),i=a.getElementsByClassName("habit-op")[0],n=i.children[0],s=i.children[1],r=a.getElementsByClassName("thumb-image"),o=r.length;for(t=0;o>t;t++)r[t].style.opacity="1.0";n.disabled=!1,s.disabled=!1,n.className="op op-done",s.className="op op-fail"}function refreshHabit(e){updateGUI(e),updateBar(e)}function updateGUI(e){var t=e.habit_id,a=document.getElementById("habitItem_"+t),i=a.getElementsByClassName("graph-message")[0],n=a.getElementsByClassName("complete-message")[0],s="days",r="days";1==e.completed_days&&(s="day"),1==e.current_streak&&(r="day"),i.innerHTML="Habit completed <strong>"+e.completed_days+"</strong><strong> / "+e.total_days+"</strong> days. <br>",e.completed_today>=e.daily_freq?(n.innerHTML="<strong style='color: rgba(30, 85, 132, 1.0);'>"+e.current_streak+"</strong> "+r+" in a row! Best Record: <strong style='color: rgba(30, 85, 132, 1.0);'>"+e.longest_streak+"</strong><br>",disableHabit(t)):-1==e.completed_today?(n.innerHTML="Habit <strong style='color: rgba(199, 35, 20, 0.76);'>failed</strong>.                                               Try harder tomorrow!",disableHabit(t)):(n.innerHTML="Completed <strong>"+e.completed_today+" / "+e.daily_freq+"</strong> times for today.",enableHabit(t))}function updateBar(e){var t=document.getElementById("habitItem_"+e.habit_id),a=t.getElementsByClassName("blue-line")[0],i=e.completed_days/e.total_days,n=160*i;n+=10;var s=n.toString();11>n||!n?a.setAttribute("stroke-width",0):(a.setAttribute("stroke-width",11),a.setAttribute("x2",s))}function toggleButton(e){var t=e.parentNode,a=findChild(t,"options-button"),i=findChild(t,"options-slideout");"options"==i.className?(i.className="options-out",a.className="op op-gear selected"):(i.className="options",a.className="op op-gear")}function toggleNotes(e){var t=getHabitRoot(e),a=t.getElementsByClassName("notes-container")[0],i=a.children[1],n=a.children[0].children[0];"margin-out"==t.className?(i.className="testy-2",t.className="margin-in",n.className="test-button"):(t.className="margin-out",i.className="testy-2-out",n.className="test-button selected")}function getHabitRoot(e){for(var t=e;"active-list"!=t.parentNode.id&&"inactive-list"!=t.parentNode.id;)t=t.parentNode;return t}function findChild(e,t){var a,i,n=e.childNodes;for(i in n)n[i].id==t&&(a=n[i]);return a}function advanceDay(){var e=document.getElementById("active-list"),t=document.getElementById("inactive-list"),a=Parse.User.current(),i=Parse.Object.extend("List"),n=new Parse.Query(i);n.get(a.get("list"),{success:function(a){currentDate.setDate(currentDate.getDate()+1),document.getElementById("header-text").innerHTML="Habit List - "+days[currentDate.getDay()]+" "+(currentDate.getMonth()+1)+"/"+currentDate.getDate();var i,n,s=a.get("habits");for(n in s){i=s[n];var r=currentDate.getDay();i.weekly_freq[r]&&(i.total_days+=1,i.completed_today<i.daily_freq&&(i.current_streak=0),i.completed_today=0)}for(a.set("habits",s),a.save();e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)t.removeChild(t.firstChild);populateList()},error:function(e,t){alert("Error: "+t.code+" "+t.message)}})}javascriptErrorAnalytics();var days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],currentDate=new Date;document.getElementById("header-text").innerHTML+=" - "+days[currentDate.getDay()]+" "+(currentDate.getMonth()+1)+"/"+currentDate.getDate(),populateList();</script></body></html>