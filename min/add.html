<!DOCTYPE html><html><head><script src="https://www.parsecdn.com/js/parse-latest.js"></script><script src="../js/global.js"></script><script>initParse();</script><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title id="pageTitle">Habit</title><link rel="stylesheet" href="../css/forms.css"><script>window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser. Custom image upload not available.");</script></head><body onload="checkCurrentUser(),populateImages(),fillForm()"><input id="logoutButton" class="standard-button" type="button" onclick="logOut()" value="Log Out" title="Log Out"><h3 id="usernameDisplay"></h3><div id="formDisplay"><h2 id="pageHeader">&nbsp;</h2><form><p><label id="title_text" style="margin-right: 10px">Habit Title</label><label id="title_err_empty" style="color: red; visibility: hidden; position: absolute">*Please enter a non-empty title.</label><label id="title_err_unique" style="color: red; visibility: hidden; position: absolute">*Please enter an unique title.</label></p><p><input id="habit_title" type="text" name="fullname" placeholder=" Exercise 30 minutes" title="Please enter a title."></p><p><label>Habit Icon</label></p><div id="habit_icons" class="scroll"><label for="file-input" id="input-image"><img id="../img/add.pngID" class="icon adder" src="../img/addImage.png" alt="find a image"></label><img id="run.jpg" class="icon" onclick="selectImage(this)" src="../img/run.jpg" alt="run image"> <img id="sleep.jpg" class="icon" onclick="selectImage(this)" src="../img/sleep.jpg" alt="sleep image"> <img id="salad.jpg" class="icon" onclick="selectImage(this)" src="../img/salad.jpg" alt="eat image"> <img id="smoke.jpg" class="icon" onclick="selectImage(this)" src="../img/smoke.jpg" alt="smoke image"> <img id="eat.jpg" class="icon" onclick="selectImage(this)" src="../img/eat.jpg" alt="eat image"> <input id="file-input" type="file" onchange="readURL(this)"></div><p><label style="margin-right: 10px">Weekly Frequency</label><label id="weekly_err" style="color: red; visibility: hidden; position: absolute">*Please select at least one weekly frequency.</label></p><div id="ck-button"><label><input id="SundayID" type="checkbox" name="date" value="Sunday"><span title="Sunday">Sun</span></label><label><input id="MondayID" type="checkbox" name="date" value="Monday"><span title="Monday">Mon</span></label><label><input id="TuesdayID" type="checkbox" name="date" value="Tuesday"><span title="Tuesday">Tues</span></label><label><input id="WednesdayID" type="checkbox" name="date" value="Wednesday"><span title="Wednesday">Wed</span></label><label><input id="ThursdayID" type="checkbox" name="date" value="Thursday"><span title="Thursday">Thur</span></label><label><input id="FridayID" type="checkbox" name="date" value="Friday"><span title="Friday">Fri</span></label><label><input id="SaturdayID" type="checkbox" name="date" value="Saturday"><span title="Saturday">Sat</span></label></div><p><label>Daily Frequency</label></p><div id="daily-button"><label><input id="Day1ID" type="radio" name="day" value="1" checked="checked"><span title="1">1</span></label><label><input id="Day2ID" type="radio" name="day" value="2"><span title="2">2</span></label><label><input id="Day3ID" type="radio" name="day" value="3"><span title="3">3</span></label><div id="times">times</div></div><p><label><span id="notes_text">Notes (optional):</span></label></p><p><input id="notes" maxlength="57" type="text" name="day" placeholder=" None" title="Please enter some optional notes."></p><p id="button_p" style="text-align: center"><input id="save" class="formButton" type="button" value="Save It" title="Save It" onclick="onAddSubmit()"> <input id="cancel" class="formButton" type="button" value="Cancel" title="Cancel" onclick="onCancel()"></p></form></div><script>function onAddSubmit(){var e=document.getElementById("habit_title").value,t=document.getElementById("title_err_unique"),i=document.getElementById("title_err_empty"),n=document.getElementById("weekly_err");i.style.visibility="hidden",t.style.visibility="hidden",n.style.visibility="hidden";for(var a=!1,r=document.getElementById("ck-button").children,d=!1,c=0;c<r.length;c++){var l=r[c].children.date;if(l.checked){d=!0;break}}if(d||(n.style.visibility="visible",a=!0),""===e)return void(i.style.visibility="visible");var s=Parse.User.current(),o=Parse.Object.extend("List"),u=new Parse.Query(o);u.get(s.get("list"),{success:function(i){var n,r,d=i.get("habits");for(r in d)if(n=d[r],n.habit_id==e)return void(t.style.visibility="visible");if(!a){newHabit.habit_id=document.getElementById("habit_title").value,newHabit.weekly_freq=getWeeklyFrequency(),newHabit.daily_freq=getDailyFrequency(),newHabit.notes=document.getElementById("notes").value;var c=currentDate.getDay();newHabit.weekly_freq[c]||(newHabit.total_days=0),i.add("habits",newHabit),habitCRUDAnalytics("Create",s.get("username"),newHabit.habit_id,""),i.save().then(function(){window.location="list.html"})}},error:function(e,t){habitCRUDAnalytics("Create",s.get("username"),newHabit.habit_id,JSON.stringify(t.code)),console.log("Error: "+t.code+" "+t.message)}})}function onCancel(){window.location="list.html"}function fillForm(){var e=(document.getElementById("formDisplay"),document.getElementById("usernameDisplay")),t=Parse.User.current();e.innerHTML="Hello, "+t.get("username");var i=Parse.Object.extend("List"),n=new Parse.Query(i);n.get(t.get("list"),{success:function(e){var t=e.get("habits"),i=e.get("edit_id"),n=document.getElementById("pageTitle"),a=document.getElementById("pageHeader");if(""===i)return n.innerHTML="Add A Habit",void(a.innerHTML="Add A Habit");var r=document.getElementById("save");n.innerHTML="Edit A Habit",a.innerHTML="Edit A Habit",r.setAttribute("onclick","onEditSubmit();");var d,c=document.getElementById("ck-button").children;for(d=0;d<c.length;d++)c[d].children.date.checked=!1;var l,s;for(s in t)if(t[s].habit_id==i){l=t[s];break}if(l){document.getElementById("habit_title").value=l.habit_id;var o;for(o=0;o<l.weekly_freq.length;o++)if(l.weekly_freq[o])switch(o){case 0:document.getElementById("SaturdayID").checked=!0;break;case 1:document.getElementById("MondayID").checked=!0;break;case 2:document.getElementById("TuesdayID").checked=!0;break;case 3:document.getElementById("WednesdayID").checked=!0;break;case 4:document.getElementById("ThursdayID").checked=!0;break;case 5:document.getElementById("FridayID").checked=!0;break;case 6:document.getElementById("SundayID").checked=!0}var u=document.getElementById(l.icon.icon_id);selectImage(u),document.getElementById("Day"+l.daily_freq+"ID").checked=!0,document.getElementById("notes").value=l.notes}else alert("Sorry. This habit seems to have been deleted."),window.location="list.html"},error:function(e,t){console.log("Error: "+t.code+" "+t.message)}})}function onEditSubmit(){var e=document.getElementById("habit_title").value,t=document.getElementById("title_err_unique"),i=document.getElementById("title_err_empty"),n=document.getElementById("weekly_err");i.style.visibility="hidden",t.style.visibility="hidden",n.style.visibility="hidden";for(var a=!1,r=document.getElementById("ck-button").children,d=!1,c=0;c<r.length;c++){var l=r[c].children.date;if(l.checked){d=!0;break}}if(d||(n.style.visibility="visible",a=!0),""===e)return void(i.style.visibility="visible");var s=Parse.User.current(),o=Parse.Object.extend("List"),u=new Parse.Query(o);u.get(s.get("list"),{success:function(i){var n,r,d=i.get("habits");for(r in d)if(n=d[r],n.habit_id==e&&n.habit_id!=i.get("edit_id"))return void(t.style.visibility="visible");if(!a){for(r in d)if(d[r].habit_id==i.get("edit_id")){d.splice(r,1);break}newHabit.habit_id=document.getElementById("habit_title").value,newHabit.weekly_freq=getWeeklyFrequency(),newHabit.daily_freq=getDailyFrequency(),newHabit.notes=document.getElementById("notes").value,d.push(newHabit),i.set("habits",d),i.set("edit_id",""),habitCRUDAnalytics("Update",s.get("username"),newHabit.habit_id,""),i.save().then(function(){window.location="list.html"})}},error:function(e,t){habitCRUDAnalytics("Update",s.get("username"),newHabit.habit_id,JSON.stringify(t.code)),console.log("Error: "+t.code+" "+t.message)}})}function getWeeklyFrequency(){var e,t,i=document.getElementById("ck-button").children,n=[];for(t=0;t<i.length;t++)e=i[t].children.date,e.checked?n.push(!0):n.push(!1);if(0===n.length)for(t=0;t<i.length;t++)e=i[t].children.date,n.push(!0);return n}function getDailyFrequency(){for(var e,t=document.getElementById("daily-button").children,i=0;i<t.length;i++)if(e=t[i].children.day,e.checked)return e.value;return 0}function selectImage(e){for(var t=document.getElementById("habit_icons").children,i=0;i<t.length;i++)t[i].className="icon";e.className="icon icon-selected",newHabit.icon.icon_id=e.id,newHabit.icon.icon_src=e.src}function readURL(e){var t,i,n,a=document.getElementById("habit_icons"),r=document.getElementById("input-image");if(e.files&&e.files[0]){var d=new FileReader;i=e.files[0].name,d.onload=function(i){t=i.target.result,n=new Parse.File(e.files[0].name,{base64:t}),n.save().then(function(){var e,t=Parse.User.current(),i=Parse.Object.extend("List"),d=new Parse.Query(i);d.get(t.get("list"),{success:function(t){e=t.get("user_images"),t.add("user_images",n),t.save();var i;i=document.createElement("img"),i.id=n.name(),i.className="icon",i.src=n.url(),i.onclick=function(){selectImage(this)},a.insertBefore(i,r.nextSibling),selectImage(i)},error:function(e,t){console.log("Error: "+t.code+" "+t.message)}})},function(e){console.log("Error: "+e.code+" "+e.message)})}}d.readAsDataURL(e.files[0])}function populateImages(){var e,t=document.getElementById("habit_icons"),i=document.getElementById("input-image"),n=Parse.User.current(),a=Parse.Object.extend("List"),r=new Parse.Query(a);r.get(n.get("list"),{success:function(n){if(e=n.get("user_images")){var a,r;for(r in e)a=document.createElement("img"),a.id=e[r].name(),a.className="icon",a.src=e[r].url(),a.onclick=function(){selectImage(this)},t.insertBefore(a,i.nextSibling)}""===n.get("edit_id")&&selectImage(t.children[1]);var d=document.getElementById("formDisplay");window.getComputedStyle(d).opacity,d.style.opacity=1},error:function(e,t){console.log("Error: "+t.code+" "+t.message)}})}javascriptErrorAnalytics();var newHabit={habit_id:"",icon:{icon_src:"",icon_id:""},weekly_freq:[],daily_freq:1,notes:"",completed_days:0,total_days:1,current_streak:0,longest_streak:0,completed_today:0},currentDate=new Date;</script></body></html>