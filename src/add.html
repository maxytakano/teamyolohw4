<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Add a habit</title>
		<link rel="stylesheet" href="../css/forms.css">
	</head>
	<body>
		<div class="forms">
			<h2>Add A Habit</h2>
			<form>
				<p><label><span id="title_text">Habit Title</span></label></p>
				<p><input id="habit_title" type="text" name="fullname" placeholder="Exercise 30 minutes"></p>
				<p><label>Habit Icon</label></p>
				<div id="habit_icons">
					<img id="icon1" class="icon" onclick="selectImage('icon1');" src="../img/sleep.jpg" alt="sleep image"/>
					<img id="icon2" class="icon" onclick="selectImage('icon2');" src="../img/salad.jpg" alt="eat image"/>
					<img id="icon3" class="icon" onclick="selectImage('icon3');" src="../img/run.jpg" alt="run image"/>
					<img id="icon4" class="icon" src="../img/add.png" alt="find a image"/>
				</div>
				<p><label>Weekly Frequency (optional)</label></p>
				<div id="ck-button">
					<label> <input type="checkbox" name="date" value="sunday"><span>Sun</span></label>
					<label> <input type="checkbox" name="date" value="monday"><span>Mon</span></label>
					<label> <input type="checkbox" name="date" value="tuesday"><span>Tues</span></label>
					<label> <input type="checkbox" name="date" value="wednesday"><span>Wed</span></label>
					<label> <input type="checkbox" name="date" value="thursday"><span>Thur</span></label>
					<label> <input type="checkbox" name="date" value="friday"><span>Fri</span></label>
					<label> <input type="checkbox" name="date" value="saturday"><span>Sat</span></label>
				</div>

				<p><label>Daily Frequency</label></p>
				<div id="daily-button">
					<label> <input type="radio" name="day" value="1" checked="checked"><span>1</span></label>
					<label> <input type="radio" name="day" value="2"><span>2</span></label>
					<label> <input type="radio" name="day" value="3"><span>3</span></label>
					<span id="times">times</span>
				</div>
				<p><label><span id="notes_text">Notes (optional): </span></label></p>
				<p><input id="notes" type="text" name="day" placeholder="More than 3 times"></p>
				<p id="save_p"><input id="save" type="button" value="Save It" onclick="location.href='list.html'"></p>
				<p id="test_button"><input id="test" type="button" value="press me to see submitted object" onclick="onSubmit()"></p>

			</form>

		</div>
		<script>
			/**
			 * habit object which is filled and submitted after the form
			 * passes validation.
			 *
			 * Required fields: habit_title
			 * Optional fields: icon, weekly_freq, daily_freq, notes
			 */
			var habit = {
				id : "",
				title : "",
				icon : "../img/salad.jpg",
				weekly_freq : [],
				daily_freq : 1,
				notes : ""
			};

			function onSubmit() {
				// Populate the habit object
				habit.title = document.getElementById('habit_title').value;
				habit.weekly_freq = getWeeklyFrequency();
				habit.daily_freq = getDailyFrequency();
				habit.notes = document.getElementById('notes').value;

				// If form validates, submit habit
				if (validateForm()) {

					// Check if habit list exists in local storage already,
					// if list does not exist, create a new list with new habit
					if(localStorage.length == 0) {

						// 'nextID' is an unique counter for IDing habit objects
						localStorage['nextID'] = '1';

						// Set the habit item's ID
						habit.id = '0';
						var newList = [];
						newList[0] = habit;

						// Store the new array
						localStorage['habitList'] = JSON.stringify(newList);
					}
					// if list exists, add habit to list
					else {

						// save habit data object into local storage 
						var existingList = JSON.parse(localStorage['habitList']);

						// if list exists, check if it is empty
						// if empty, reset nextID counter, and add new habit
						if(existingList.length == 0) {

							// Set the habit item's ID
							localStorage['nextID'] = '1';
							habit.id = '0';
							existingList[0] = habit;
							localStorage['habitList'] = JSON.stringify(existingList);
						}
						// if not empty, continue adding habit item as normal
						else {
							// Set the habit item's ID
							habit.id = localStorage['nextID'];
							localStorage['nextID'] = (parseInt(localStorage['nextID'])+1);
							existingList.push(habit);

							// Store newly modified array
							localStorage['habitList'] = JSON.stringify(existingList);
						}
					}

					// navigate to list page
					window.location = 'list.html';
				} else {
					alert('form failed validation');
					// do nothing
				}
			}

			/**
			 * Validates the current habit object to see if the form can be submitted
			 * returns true if the form validates, false if it doesn't.
			 */
			function validateForm() {
				// Check if the user entered a title.
				if (habit.habit_title == "") {
					// TODO: add markup to display validation message (unhide it or w/e)
					console.log("need a title");
					return false;
				}

				// passed validation checks, return true.
				return true;
			}

			/**
			 * Returns an array with all of the currently selected weeks for weekly
			 * frequency.
			 */
			function getWeeklyFrequency() {
				var labels = document.getElementById("ck-button").children;
				var selected_weeks = [];
				var week;
				// Push each selected week into the selected_weeks array.
				for (var i = 0; i < labels.length; i++) {
					week = labels[i].children.date;
					if (week.checked) {
						selected_weeks.push(week.value);
					}
				}

				return selected_weeks;
			}

			/**
			 * Returns the selected daily frequency.
			 */
			function getDailyFrequency() {
				var labels = document.getElementById("daily-button").children;
				var selected_freq;
				for (var i = 0; i < labels.length; i++) {
					selected_freq = labels[i].children.day;
					if (selected_freq.checked) {
						// console.log(sele)
						return selected_freq.value;
					}
				}

				// return 0 if everything became unselected somehow
				return 0;
			}

			/**
			 * Sets the habit object's current icon to the selected image.
			 * Changes the border of the image to show it's selected.
			 */
			function selectImage(image_name) {
				var habit_icons = document.getElementById("habit_icons").children;
				// Clear the effects on the other images
				for (var i = 0; i < habit_icons.length; i++) {
					habit_icons[i].style.border = "none";
				}

				var cur_image = document.getElementById(image_name);
				cur_image.style.border = "5px solid #42A5F5";

				// Save the current image into the habit object.
				habit.icon = cur_image.src;
			}
		</script>
	</body>
</html>
